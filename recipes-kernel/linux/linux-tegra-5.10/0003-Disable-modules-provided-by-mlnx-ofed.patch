From dba3c15604f5bd6ba5602a4cc44f25538c89451a Mon Sep 17 00:00:00 2001
From: Ian Stewart <istewart@nvidia.com>
Date: Thu, 6 Oct 2022 20:04:11 -0600
Subject: [PATCH 3/3] Disable modules provided by mlnx-ofed

---
 arch/arm64/configs/defconfig | 9 +++++----
 1 file changed, 5 insertions(+), 4 deletions(-)

diff --git a/arch/arm64/configs/defconfig b/arch/arm64/configs/defconfig
index c49c5c304b20..7721fe8b7da3 100644
--- a/arch/arm64/configs/defconfig
+++ b/arch/arm64/configs/defconfig
@@ -455,7 +455,7 @@ CONFIG_SKY2=m
 CONFIG_SKY2_DEBUG=y
 CONFIG_OAK=m
 CONFIG_MLX4_EN=m
-CONFIG_MLX5_CORE=m
+CONFIG_MLX5_CORE=n
 CONFIG_MLX5_CORE_EN=y
 CONFIG_MLX5_CORE_IPOIB=y
 CONFIG_MLX5_CORE_THERMAL=y
@@ -1151,12 +1151,12 @@ CONFIG_LEDS_GPIO=m
 CONFIG_LEDS_PWM=m
 CONFIG_LEDS_BD2802=m
 CONFIG_LEDS_IS31FL319X=m
-CONFIG_INFINIBAND=m
+CONFIG_INFINIBAND=n
 CONFIG_INFINIBAND_USER_MAD=m
-CONFIG_INFINIBAND_USER_ACCESS=m
+CONFIG_INFINIBAND_USER_ACCESS=n
 CONFIG_INFINIBAND_MTHCA=m
 CONFIG_MLX4_INFINIBAND=m
-CONFIG_MLX5_INFINIBAND=m
+CONFIG_MLX5_INFINIBAND=n
 CONFIG_INFINIBAND_IPOIB=m
 CONFIG_INFINIBAND_IPOIB_CM=y
 CONFIG_INFINIBAND_SRP=m
@@ -1368,3 +1368,4 @@ CONFIG_STACK_TRACER=y
 # CONFIG_UPROBE_EVENTS is not set
 CONFIG_PID_IN_CONTEXTIDR=y
 # CONFIG_RUNTIME_TESTING_MENU is not set
+CONFIG_MLXSW_SPECTRUM=n
-- 
2.17.1

